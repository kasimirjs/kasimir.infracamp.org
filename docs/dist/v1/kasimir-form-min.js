/**
 * Infracamp's Kasimir Templates
 *
 * A no-dependency render on request
 *
 * @author Matthias Leuffen <m@tth.es>
 */
function ka_form(e){if(e instanceof KasimirForm)return e;let t=document.getElementById(e);if(null===t)throw`Selector '${e}' not found (no element mit id)`;if(t instanceof KasimirForm)return t;throw`Selector '${e}' is not a <form is="ka-form"> element`}class KasimirForm extends HTMLFormElement{constructor(){super(),this._data={},this.params={debounce:200},this._debounder=null,this._formEls=[];this.addEventListener("submit",e=>{e.stopPropagation(),e.preventDefault()})}_updateElCon(){for(let e of this.querySelectorAll("input,select,textarea"))this._formEls.push(e),!0!==e._kasiFormI&&(e._kasiFormI=!0,e instanceof HTMLSelectElement?e.addEventListener("change",e=>{this.dispatchEvent(new Event("change"))}):e.addEventListener("keyup",e=>{window.clearTimeout(this._debounder),"Enter"!==e.key&&(this._debounder=window.setTimeout(()=>{this.dispatchEvent(new Event("change"))},this.params.debounce))}))}get $data(){let e=e=>{switch(e.tagName){case"INPUT":switch(e.type){case"checkbox":case"radio":return 1==e.checked?e.value:null}case"SELECT":case"TEXTAREA":return e.value}};for(let t of this._formEls)""!==t.name&&(this._data[t.name]=e(t));return this._data}set $data(e){this._data=e;for(let t of this._formEls){let s=e[t.name];"INPUT"===t.tagName&&"checkbox"===t.type||"radio"===t.type?s===t.value?t.checked=!0:t.checked=!1:t.value=s}}disconnectedCallback(){this._observer.disconnect()}connectedCallback(){this._observer=new MutationObserver(e=>{this._updateElCon()}),this._observer.observe(this,{childList:!0,subtree:!0}),this._updateElCon()}}customElements.define("ka-form",KasimirForm,{extends:"form"});class KasimirSelect extends HTMLSelectElement{constructor(){super(),this.__$options=[]}_updateOptions(){this.innerHTML="";for(let e of this.__$options){let t=document.createElement("option");"object"==typeof e?(t.value=e.value,t.innerText=e.text):(t.value=e,t.innerText=e),this.appendChild(t)}}connectedCallback(){let e=this.$options,t=this.$value;Object.defineProperty(this,"$options",{set:e=>{this.__$options=e,this._updateOptions()},get:e=>this.__$options}),Object.defineProperty(this,"$value",{set:e=>{this.value=e},get:e=>this.value}),void 0!==e&&(this.$options=e),void 0!==t&&(this.$value=t)}}customElements.define("ka-select",KasimirSelect,{extends:"select"});