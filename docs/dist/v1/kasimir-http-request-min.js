/**
 * Infracamp's Kasimir Http Request
 *
 * Ajax Request library
 *
 * Repository: https://github.com/kasimirjs/kasmimir-http-request
 *
 * @see https://infracamp.org/project/kasimir
 * @author Matthias Leuffen <m@tth.es>
 */
function ka_http_req(t,e={}){return new KasimirHttpRequest(t,e)}class KasimirHttpRequest{constructor(t,e={}){t=t.replace(/(\{|\:)([a-zA-Z0-9_\-]+)/g,(s,r,i)=>{if(!e.hasOwnProperty(i))throw"parameter '"+i+"' missing in url '"+t+"'";return encodeURI(e[i])}),this.request={url:t,method:"GET",body:null,headers:{},dataType:"text",onError:null,debug:!1,data:null}}withParams(t){-1===this.request.url.indexOf("?")?this.request.url+="?":this.request.url+="&";let e=[];for(let s in t)t.hasOwnProperty(s)&&e.push(encodeURIComponent(s)+"="+encodeURIComponent(t[s]));return this.request.url+=e.join("&"),this}withMethod(t){return this.request.method=t,this}withBearerToken(t){return this.withHeaders({authorization:"bearer "+t}),this}withHeaders(t){return Object.assign(this.request.headers,t),this}withBody(t){return"GET"===this.request.method&&(this.request.method="POST"),(Array.isArray(t)||"object"==typeof t)&&(t=JSON.stringify(t),this.withHeaders({"content-type":"application/json"})),this.request.body=t,this}withOnError(t){return this.request.onError=t,this}withDebug(){return this.request.debug=!0,this}set json(t){this.send(e=>{t(e.getBodyJson())})}set plain(t){this.send(e=>{t(e.getBody())})}send(t){let e=new XMLHttpRequest;e.open(this.request.method,this.request.url);for(let t in this.request.headers)e.setRequestHeader(t,this.request.headers[t]);e.onreadystatechange=(()=>{if(4!==e.readyState);else{if(null!==this.request.onError||parseInt(e.status)>=400){let t=`𝗥𝗲𝗾𝘂𝗲𝘀𝘁 𝗳𝗮𝗶𝗹𝗲𝗱 '${e.status} ${e.statusText}':`,s=e.response;try{t+="\n\n𝗠𝘀𝗴: '"+(s=JSON.parse(s)).error.msg+"'\n\n"}catch(e){t+=s}return console.warn(t,s),this.request.debug&&alert(t+"\n𝘴𝘦𝘦 𝘤𝘰𝘯𝘴𝘰𝘭𝘦 𝘧𝘰𝘳 𝘥𝘦𝘵𝘢𝘪𝘭𝘴. (𝘥𝘦𝘣𝘶𝘨 𝘮𝘰𝘥𝘦 𝘰𝘯)"),void("function"==typeof this.request.onError&&this.request.onError(new KasimirHttpResponse(e.response,e.status,this)))}if(this.request.debug){let t=e.response;try{t=JSON.parse(t)}catch(t){}console.debug(`𝗥𝗲𝗾𝘂𝗲𝘀𝘁: ${e.status} ${e.statusText}':\n`,t)}t(new KasimirHttpResponse(e.response,e.status,this))}}),e.send(this.request.body)}}class KasimirHttpResponse{constructor(t,e,s){this.body=t,this.status=e,this.request=s}getBodyJson(){return JSON.parse(this.body)}getBody(){return this.body}isOk(){return 200===this.status}}